<Window x:Class="FloridaLotteryApp.ThirdAnalysisOption1"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Opción 1 Del Tercer Análisis"
        Height="780"
        Width="1000"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    
    <Grid Margin="16">
        <TabControl>
            <!-- Pestaña 1: Vacía -->
            <TabItem Header="Búsqueda" x:Name="SearchTab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- MOSTRAR UNA SOLA TARJETA EN VEZ DE TODAS -->
                        <Border x:Name="SearchCardContainer"
                                CornerRadius="16"
                                BorderBrush="Black"
                                BorderThickness="2"
                                Padding="14"
                                Margin="0,0,0,14"
                                Background="#FFF7F7F7"
                                Visibility="Visible">
                            
                            <Grid>
                                <!-- Canvas para conectar dígitos -->
                                <Canvas x:Name="SearchPick3LinksCanvas"
                                        IsHitTestVisible="False"
                                        Panel.ZIndex="2"/>
                                
                                <Canvas x:Name="SearchNextPick3LinksCanvas"
                                        IsHitTestVisible="False"
                                        Panel.ZIndex="2"/>

                                <Canvas x:Name="SearchPick3Row3ToPick4Row4LinksCanvas"
                                        IsHitTestVisible="False"
                                        Panel.ZIndex="2"/>
                                        
                                <Canvas x:Name="SearchPick3Row4ToPick4Row3LinksCanvas"
                                        IsHitTestVisible="False"
                                        Panel.ZIndex="2"/>   

                                <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="0,8,8,0"
                                    Panel.ZIndex="3">
                                </StackPanel>             
                                
                                <StackPanel>
                                    <!-- ======= FILA 1: FECHA INTERMEDIA ======= -->
                                    <Border Background="White" CornerRadius="10" Padding="10">
                                        <StackPanel>
                                            <!-- Fecha/Tirada -->
                                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <TextBlock Text="Fecha:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="SearchRow1DateText" FontSize="16" Margin="6,0,18,0"/>
                                                <TextBlock Text="Tirada:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="SearchRow1DrawIcon" FontSize="18" Margin="6,0,0,0"/>
                                            </StackPanel>

                                            <!-- Línea de dígitos -->
                                            <Grid Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Pick3 (3) -->
                                                <ItemsControl x:Name="SearchRow1Pick3Items"
                                                            Grid.Column="0" 
                                                            ItemsSource="{Binding CurrentCard.Row1Pick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Pick4 (4) -->
                                                <ItemsControl x:Name="SearchRow1Pick4Items" Grid.Column="2" ItemsSource="{Binding CurrentCard.Row1Pick4Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="4"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- NextPick3 (3) -->
                                                <ItemsControl x:Name="SearchRow1NextPick3Items"
                                                            Grid.Column="4" 
                                                            ItemsSource="{Binding CurrentCard.Row1NextPick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Codificación (6) -->
                                                <ItemsControl x:Name="SearchRow1CodingItems" Grid.Column="6" ItemsSource="{Binding CurrentCard.Row1CodingDigits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="6"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- ======= FILA NUEVA 1A: CONTADOR CODIFICACIÓN 1-2 ======= -->
                                    <Border Background="Transparent" Height="30" Margin="0,5,0,5">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Contador de Pick4 -->
                                            <TextBlock x:Name="SearchPick4MatchesRow1Row2"
                                                    Grid.Column="1"
                                                    Text="{Binding CurrentCard.Pick4MatchesRow1Row2}"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left"
                                                    Margin="0,0,0,0"
                                                    Foreground="Black"
                                                    Padding="10,5"/>
                                            
                                            <!-- Contador de Codificación -->
                                            <TextBlock x:Name="SearchCodingMatchesRow1Row2"
                                                    Grid.Column="2"
                                                    Text="{Binding CurrentCard.CodingMatchesRow1Row2}"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left"  
                                                    Margin="350,0,10,0"  
                                                    Foreground="Black"
                                                    Padding="10,5"/>
                                        </Grid>
                                    </Border>

                                    <!-- ======= FILA 2: FECHA MENOR ======= -->
                                    <Border Background="White" CornerRadius="10" Padding="10" Margin="0,0,0,0">
                                        <StackPanel>
                                            <!-- Línea de dígitos -->
                                            <Grid Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Pick3 (3) -->
                                                <ItemsControl x:Name="SearchRow2Pick3Items"
                                                            Grid.Column="0" 
                                                            ItemsSource="{Binding CurrentCard.Row2Pick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Pick4 (4) -->
                                                <ItemsControl x:Name="SearchRow2Pick4Items" Grid.Column="2" ItemsSource="{Binding CurrentCard.Row2Pick4Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="4"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- NextPick3 (3) -->
                                                <ItemsControl x:Name="SearchRow2NextPick3Items"
                                                            Grid.Column="4" 
                                                            ItemsSource="{Binding CurrentCard.Row2NextPick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Codificación (6) -->
                                                <ItemsControl x:Name="SearchRow2CodingItems" Grid.Column="6" ItemsSource="{Binding CurrentCard.Row2CodingDigits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="6"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>

                                            <!-- Fecha/Tirada -->
                                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <TextBlock Text="Fecha:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="SearchRow2DateText" FontSize="16" Margin="6,0,18,0"/>
                                                <TextBlock Text="Tirada:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="SearchRow2DrawIcon" FontSize="18" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- ======= ESPACIO ENTRE GRUPOS ======= -->
                                    <Border Height="40" Background="Transparent"/>

                                    <!-- ======= FILA 3: FECHA MAYOR ======= -->
                                    <Border Background="White" CornerRadius="10" Padding="10" Margin="0,0,0,0">
                                        <StackPanel>
                                            <!-- Fecha/Tirada -->
                                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <TextBlock Text="Fecha:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="SearchRow3DateText" FontSize="16" Margin="6,0,18,0"/>
                                                <TextBlock Text="Tirada:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="SearchRow3DrawIcon" FontSize="18" Margin="6,0,0,0"/>
                                            </StackPanel>

                                            <!-- Línea de dígitos -->
                                            <Grid Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Pick3 (3) del resultado -->
                                                <ItemsControl x:Name="SearchRow3Pick3Items"
                                                            Grid.Column="0" 
                                                            ItemsSource="{Binding CurrentCard.Row3Pick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Pick4 (4) del resultado -->
                                                <ItemsControl x:Name="SearchRow3Pick4Items" Grid.Column="2" ItemsSource="{Binding CurrentCard.Row3Pick4Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="4"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- NextPick3 (3) del resultado -->
                                                <ItemsControl x:Name="SearchRow3NextPick3Items"
                                                            Grid.Column="4" 
                                                            ItemsSource="{Binding CurrentCard.Row3NextPick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Codificación (6) del resultado -->
                                                <ItemsControl x:Name="SearchRow3CodingItems" Grid.Column="6" ItemsSource="{Binding CurrentCard.Row3CodingDigits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="6"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                    FontSize="16" FontWeight="Bold"
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- ======= FILA NUEVA 3A: CONTADOR CODIFICACIÓN 3-4 ======= -->
                                    <Border Background="Transparent" Height="30" Margin="0,5,0,5">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Contador de Pick4 -->
                                            <TextBlock x:Name="SearchPick4MatchesRow3Row4"
                                                    Grid.Column="1"
                                                    Text="{Binding CurrentCard.Pick4MatchesRow3Row4}"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left"
                                                    Margin="0,0,0,0"
                                                    Foreground="Black"
                                                    Padding="10,5"/>

                                            <!-- Contador de Codificación -->
                                            <TextBlock x:Name="SearchCodingMatchesRow3Row4"
                                                    Grid.Column="2"
                                                    Text="{Binding CurrentCard.CodingMatchesRow3Row4}"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left"  
                                                    Margin="350,0,10,0"
                                                    Foreground="Black"
                                                    Padding="10,5"/>
                                        </Grid>
                                    </Border>

                                    <!-- ======= FILA 4: REPETIR FECHA MENOR ======= -->
                                    <Border Background="White" CornerRadius="10" Padding="10" Margin="0,0,0,0">
                                        <StackPanel>
                                            <!-- Línea de dígitos -->
                                            <Grid Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Pick3 (3) -->
                                                <ItemsControl x:Name="SearchRow4Pick3Items"
                                                            Grid.Column="0" 
                                                            ItemsSource="{Binding CurrentCard.Row4Pick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Pick4 (4) -->
                                                <ItemsControl x:Name="SearchRow4Pick4Items" Grid.Column="2" ItemsSource="{Binding CurrentCard.Row4Pick4Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="4"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- NextPick3 (3) -->
                                                <ItemsControl x:Name="SearchRow4NextPick3Items"
                                                            Grid.Column="4" 
                                                            ItemsSource="{Binding CurrentCard.Row4NextPick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Codificación (6) -->
                                                <ItemsControl x:Name="SearchRow4CodingItems" Grid.Column="6" ItemsSource="{Binding CurrentCard.Row4CodingDigits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="6"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                        FontSize="16" FontWeight="Bold"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>

                                            <!-- Fecha/Tirada -->
                                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <TextBlock Text="Fecha:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="SearchRow4DateText" FontSize="16" Margin="6,0,18,0"/>
                                                <TextBlock Text="Tirada:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="SearchRow4DrawIcon" FontSize="18" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- CONTROLES DE NAVEGACIÓN (MANTENIDOS PERO AHORA VISIBLES) -->
                        <Grid Margin="0,20,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Botón Anterior -->
                            <Button x:Name="PreviousButton"
                                    Grid.Column="1"
                                    Content="⬅️ Anterior"
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Padding="15,8"
                                    Background="#2196F3"
                                    Foreground="White"
                                    BorderBrush="#1976D2"
                                    BorderThickness="1"
                                    Cursor="Hand"
                                    Visibility="Visible"
                                    Click="PreviousButton_Click"
                                    ToolTip="Ver resultado anterior">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="8">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                        VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#1976D2"/>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Background" Value="#BBDEFB"/>
                                                <Setter Property="Foreground" Value="#757575"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <!-- Botón Siguiente -->
                            <Button x:Name="NextButton"
                                    Grid.Column="3"
                                    Content="Siguiente ➡️"
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Padding="15,8"
                                    Background="#4CAF50"
                                    Foreground="White"
                                    BorderBrush="#388E3C"
                                    BorderThickness="1"
                                    Cursor="Hand"
                                    Visibility="Visible"
                                    Click="NextButton_Click"
                                    ToolTip="Ver siguiente resultado">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="8">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                        VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#388E3C"/>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Background" Value="#C8E6C9"/>
                                                <Setter Property="Foreground" Value="#757575"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>

                        <!-- Progreso de búsqueda -->
                        <StackPanel Margin="0,12,0,0" HorizontalAlignment="Center">
                            <ProgressBar x:Name="ResultsProgress"
                                        Width="320"
                                        Height="18"
                                        Minimum="0"
                                        Maximum="100"
                                        Visibility="Collapsed"/>
                            <TextBlock x:Name="ResultsProgressText"
                                    HorizontalAlignment="Center"
                                    FontSize="12"
                                    Margin="0,6,0,0"
                                    Foreground="#666666"
                                    Visibility="Collapsed"/>
                        </StackPanel>

                        <!-- Contador de resultados -->
                        <TextBlock x:Name="ResultsCounter"
                                HorizontalAlignment="Center"
                                FontSize="14"
                                Margin="0,12,0,0"
                                Foreground="#666666"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Pestaña 2: Tarjeta de Análisis -->
            <TabItem Header="Patrón Guía" x:Name="AnalysisTab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <Border x:Name="AnalysisCardContainer"
                                CornerRadius="16"
                                BorderBrush="Black"
                                BorderThickness="2"
                                Padding="14"
                                Margin="0,0,0,14"
                                Background="#FFF7F7F7">
                            
                            <Grid>
                                <!-- Canvas para conectar dígitos -->
                                <Canvas x:Name="Pick3LinksCanvas"
                                        IsHitTestVisible="False"
                                        Panel.ZIndex="2"/>
                                
                                <Canvas x:Name="NextPick3LinksCanvas"
                                        IsHitTestVisible="False"
                                        Panel.ZIndex="2"/>

                                <Canvas x:Name="Pick3Row3ToPick4Row4LinksCanvas"
                                        IsHitTestVisible="False"
                                        Panel.ZIndex="2"/>
                                        
                                <Canvas x:Name="Pick3Row4ToPick4Row3LinksCanvas"
                                        IsHitTestVisible="False"
                                        Panel.ZIndex="2"/>   

                                <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="0,8,8,0"
                                    Panel.ZIndex="3">
                        </StackPanel>             
                                
                                <StackPanel>
                                    <!-- ======= FILA 1: FECHA INTERMEDIA ======= -->
                                    <Border Background="White" CornerRadius="10" Padding="10">
                                        <StackPanel>
                                            <!-- Fecha/Tirada -->
                                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <TextBlock Text="Fecha:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="Row1DateText" FontSize="16" Margin="6,0,18,0"/>
                                                <TextBlock Text="Tirada:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="Row1DrawIcon" FontSize="18" Margin="6,0,0,0"/>
                                            </StackPanel>

                                            <!-- Línea de dígitos -->
                                            <Grid Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Pick3 (3) -->
                                                <ItemsControl x:Name="Row1Pick3Items"
                                                            Grid.Column="0" 
                                                            ItemsSource="{Binding Row1Pick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Pick4 (4) -->
                                                <ItemsControl x:Name="Row1Pick4Items" Grid.Column="2" ItemsSource="{Binding Row1Pick4Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="4"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- NextPick3 (3) -->
                                                <ItemsControl x:Name="Row1NextPick3Items"
                                                            Grid.Column="4" 
                                                            ItemsSource="{Binding Row1NextPick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Codificación (6) -->
                                                <ItemsControl x:Name="Row1CodingItems" Grid.Column="6" ItemsSource="{Binding Row1CodingDigits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="6"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                       VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- ======= FILA NUEVA 1A: CONTADOR CODIFICACIÓN 1-2 ======= -->
                                    <Border Background="Transparent" Height="30" Margin="0,5,0,5">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Contador de Pick4 -->
                                            <TextBlock x:Name="Pick4MatchesRow1Row2"
                                                    Grid.Column="1"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left"
                                                    Margin="0,0,0,0"
                                                    Foreground="Black"
                                                    Padding="10,5"/>
                                            
                                            <!-- Contador de Codificación -->
                                            <TextBlock x:Name="CodingMatchesRow1Row2"
                                                    Grid.Column="2"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left"  
                                                    Margin="350,0,10,0"  
                                                    Foreground="Black"
                                                    Padding="10,5"/>
                                        </Grid>
                                    </Border>

                                    <!-- ======= FILA 2: FECHA MENOR ======= -->
                                    <Border Background="White" CornerRadius="10" Padding="10" Margin="0,0,0,0">
                                        <StackPanel>
                                            <!-- Línea de dígitos -->
                                            <Grid Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Pick3 (3) -->
                                                <ItemsControl x:Name="Row2Pick3Items"
                                                            Grid.Column="0" 
                                                            ItemsSource="{Binding Row2Pick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Pick4 (4) -->
                                                <ItemsControl x:Name="Row2Pick4Items" Grid.Column="2" ItemsSource="{Binding Row2Pick4Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="4"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- NextPick3 (3) -->
                                                <ItemsControl x:Name="Row2NextPick3Items"
                                                            Grid.Column="4" 
                                                            ItemsSource="{Binding Row2NextPick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Codificación (6) -->
                                                <ItemsControl x:Name="Row2CodingItems" Grid.Column="6" ItemsSource="{Binding Row2CodingDigits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="6"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>

                                            <!-- Fecha/Tirada -->
                                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <TextBlock Text="Fecha:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="Row2DateText" FontSize="16" Margin="6,0,18,0"/>
                                                <TextBlock Text="Tirada:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="Row2DrawIcon" FontSize="18" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- ======= ESPACIO ENTRE GRUPOS ======= -->
                                    <Border Height="40" Background="Transparent"/>

                                    <!-- ======= FILA 3: FECHA MAYOR ======= -->
                                    <Border Background="White" CornerRadius="10" Padding="10" Margin="0,0,0,0">
                                        <StackPanel>
                                            <!-- Fecha/Tirada -->
                                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <TextBlock Text="Fecha:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="Row3DateText" FontSize="16" Margin="6,0,18,0"/>
                                                <TextBlock Text="Tirada:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="Row3DrawIcon" FontSize="18" Margin="6,0,0,0"/>
                                            </StackPanel>

                                            <!-- Línea de dígitos -->
                                            <Grid Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Pick3 (3) del resultado -->
                                                <ItemsControl x:Name="Row3Pick3Items"
                                                            Grid.Column="0" 
                                                            ItemsSource="{Binding Row3Pick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Pick4 (4) del resultado -->
                                                <ItemsControl x:Name="Row3Pick4Items" Grid.Column="2" ItemsSource="{Binding Row3Pick4Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="4"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- NextPick3 (3) del resultado -->
                                                <ItemsControl x:Name="Row3NextPick3Items"
                                                            Grid.Column="4" 
                                                            ItemsSource="{Binding Row3NextPick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Codificación (6) del resultado -->
                                                <ItemsControl x:Name="Row3CodingItems" Grid.Column="6" ItemsSource="{Binding Row3CodingDigits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="6"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                       FontSize="16" FontWeight="Bold"
                                                                       HorizontalAlignment="Center"
                                                                       VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- ======= FILA NUEVA 3A: CONTADOR CODIFICACIÓN 3-4 ======= -->
                                    <Border Background="Transparent" Height="30" Margin="0,5,0,5">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Contador de Pick4 -->
                                            <TextBlock x:Name="Pick4MatchesRow3Row4"
                                                    Grid.Column="1"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left"
                                                    Margin="0,0,0,0"
                                                    Foreground="Black"
                                                    Padding="10,5"/>

                                            <!-- Contador de Codificación -->
                                            <TextBlock x:Name="CodingMatchesRow3Row4"
                                                    Grid.Column="2"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left"  
                                                    Margin="350,0,10,0"
                                                    Foreground="Black"
                                                    Padding="10,5"/>
                                        </Grid>
                                    </Border>

                                    <!-- ======= FILA 4: REPETIR FECHA MENOR ======= -->
                                    <Border Background="White" CornerRadius="10" Padding="10" Margin="0,0,0,0">
                                        <StackPanel>
                                            <!-- Línea de dígitos -->
                                            <Grid Margin="0,10,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="26"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Pick3 (3) -->
                                                <ItemsControl x:Name="Row4Pick3Items"
                                                            Grid.Column="0" 
                                                            ItemsSource="{Binding Row4Pick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Pick4 (4) -->
                                                <ItemsControl x:Name="Row4Pick4Items" Grid.Column="2" ItemsSource="{Binding Row4Pick4Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="4"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- NextPick3 (3) -->
                                                <ItemsControl x:Name="Row4NextPick3Items"
                                                            Grid.Column="4" 
                                                            ItemsSource="{Binding Row4NextPick3Digits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="3"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                                <!-- Codificación (6) -->
                                                <ItemsControl x:Name="Row4CodingItems" Grid.Column="6" ItemsSource="{Binding Row4CodingDigits}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Rows="1" Columns="6"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Width="34" Height="34" CornerRadius="17"
                                                                    BorderThickness="2" 
                                                                    Background="{Binding Bg}"
                                                                    Margin="4,0">
                                                                <TextBlock Text="{Binding Value}"
                                                                           FontSize="16" FontWeight="Bold"
                                                                           HorizontalAlignment="Center"
                                                                           VerticalAlignment="Center"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>

                                            <!-- Fecha/Tirada -->
                                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <TextBlock Text="Fecha:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="Row4DateText" FontSize="16" Margin="6,0,18,0"/>
                                                <TextBlock Text="Tirada:" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="Row4DrawIcon" FontSize="18" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
